<!doctype html>

<head>
    <meta charset="utf-8">
    <title>bitcoind-nonsense</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="c3.css">
    <script src="vue.min.js"></script>
    <script src="moment.min.js"></script>
    <script src="d3.v3.min.js"></script>
    <script src="c3.min.js"></script>
    <script src="index.js"></script>
</head>

<body>
    <div id="app">
        <div id="header"
            :class="connected ? 'connected' : 'disconnected'"
        >
            <h1>
                esotericnonsense.com:8333
                {{ connected ? '' : '(disconnected)' }}
            </h1>
        </div>

        <div class="section" id="chooser">
            <span
                :class="range === 30 ? 'selected' : 'deselected'"
                v-on:click="setRange(30)">
                30m
            </span>
            <span
                :class="range === 120 ? 'selected' : 'deselected'"
                v-on:click="setRange(120)">
                2h
            </span>
            <span
                :class="range === 240 ? 'selected' : 'deselected'"
                v-on:click="setRange(240)">
                4h
            </span>
            <span
                :class="range === 480 ? 'selected' : 'deselected'"
                v-on:click="setRange(480)">
                8h
            </span>
            <span
                :class="range === 1440 ? 'selected' : 'deselected'"
                v-on:click="setRange(1440)">
                24h
            </span>
        </div>

        <div id="mempoolchart"></div>

        <div class="section" v-if="mempoolbins">
            <h2>mempool info (next update in {{ Math.max(0, Math.floor(range/2 - (now - last_updated))) }}s)</h2>
            <p>
                Transactions: {{ mempoolbins.size }} {{ mempoolbins.size_segwit !== "?" ? `(${mempoolbins.size_segwit} segwit)` : "" }}
            </p>
            <p>
                Size: {{ mempoolbins.bytes }} bytes
            </p>
            <p>
                Fees: {{ (mempoolbins.fees / 10**5).toFixed(2) }} mBTC
            </p>
        </div>

        <div class="section" v-if="mempoolbins">
            <h2>mempool contents</h2>
            <table>
                <thead>
                    <tr>
                        <th style="border: none;"></th>
                        <th colspan=3>this bin</th>
                        <th colspan=3>cumulative</th>
                    </tr>
                    <tr>
                        <th>limits / sat/b</th>
                        <th>tx</th>
                        <th>size / B</th>
                        <th>amt / mBTC</th>
                        <th>tx</th>
                        <th>size / B</th>
                        <th>amt / mBTC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="bin in mempoolbins.bins">
                        <td>{{ bin[0] }} - {{ (bin[1] < 21*(10**14)) ? bin[1] : 'max' }}</td>
                        <td>{{ bin[2] }}</td>
                        <td>{{ bin[3] }}</td>
                        <td>{{ (bin[4]/(10**5)).toFixed(2) }}</td>
                        <td>{{ bin[5] }}</td>
                        <td>{{ bin[6] }}</td>
                        <td>{{ (bin[7]/(10**5)).toFixed(2) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="blocks">
            <h2>blocks</h2>
            <table>
                <thead>
                    <th>age</th>
                    <th>height</th>
                    <th>hash</th>
                    <th>size</th>
                </thead>
                <tbody>
                    <tr
                        v-for="block in sortedBlocks"
                    >
                        <td>{{ (now - block.time) | timeInterval }}</td>
                        <td>{{ block.height }}</td>
                        <td>{{ block.hash }}</td>
                        <td>{{ block.size }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="section" id="donations">
            <h2>donations</h2>
            <p>
                <a href="bitcoin:3BYFucUnVNhZjUDf6tZweuZ5r9PPjPEcRv"><img src="./3BYFucUnVNhZjUDf6tZweuZ5r9PPjPEcRv.png"></img></a>
            </p>
            <p>
                <a href="bitcoin:3BYFucUnVNhZjUDf6tZweuZ5r9PPjPEcRv">3BYFucUnVNhZjUDf6tZweuZ5r9PPjPEcRv</a> (bitcoin)
            </p>
        </div>
        <div class="section">
            <h2>notes</h2>
            <p>
                all data here is gleaned from the node running at esotericnonsense:8333
            </p>
            <p>
                note that there is no universal mempool, your results may differ
            </p>
            <p>
                mobile viewing is suboptimal - sorry :(
            </p>
        </div>
    </div>
</body>
